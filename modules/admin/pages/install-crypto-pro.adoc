:root-cert: корневой сертификат удостоверяющего центраfootnote:[Например, корневой сертификат КриптоПро]

= Настройка компонентов КриптоПро

Для формирования усиленной подписи (с использованием сертификатов ЭП) необходимо установить компоненты КриптоПро и сертификаты.

Формирование усиленной подписи возможно только на персональных компьютерах, соответствующих требованиям:

* Операционная система: Windows или Mac OS (версии см. в https://www.cryptopro.ru/products/csp/compare[требованиях] КриптоПро CSP);
* Веб-браузер: Google Chrome, Яндекс.Браузер или Microsoft Edge на Chromium (поддерживаемые версии приведены в руководстве администратора).

Далее приведена инструкция по установке компонентов КриптоПро для ОС Windows. Инструкцию для ОС Mac OS см. в документации КриптоПро и сети Интернет, например, по https://support.cryptopro.ru/index.php?/Knowledgebase/Article/View/232/0/rbot-s-kriptopro-csp-v-macos[ссылке].

.Установите расширение для браузера:
. В {wc}е нажмите image:user:buttons/person-grey.png[Меню] (может содержать фото) > Профиль. Будет открыто диалоговое окно xref:user:interface-user-profile.adoc[профиля пользователя].
. Перейдите в раздел _Установки_.
. Перейдите по ссылке "Установить КриптоПро ЭЦП Browser plug-in".
+
Будет загружен файл `cadesplugin.exe`.
+
. Закройте веб-браузер и запустите загруженный файл `cadesplugin.exe`. Будет предложено установить "КриптоПро ЭЦП Browser plug-in".
. Согласитесь с установкой и дождитесь её завершения.
. Установите расширение CryptoPro Extension for CAdES Browser Plug-in со https://chrome.google.com/webstore/detail/cryptopro-extension-for-c/iifchhfnnmpdbibifmljnfjhpififfog[страницы расширения].
. Установите сертификат пользователя.

.Неквалифицированный сертификат:
. Установите в хранилище "Личное" на уровне "Текущий пользователь".

.Квалифицированный сертификат КриптоПро:
. Установите на компьютер https://www.cryptopro.ru/products/csp/downloads[СКЗИ КриптоПро CSP].
. Установите квалифицированный сертификат пользователя в хранилище _Личное_ на уровне _Текущий пользователь_.
. Установите
ifdef::root-cert[{root-cert}]
в хранилище _Доверенные корневые центры сертификации_ на уровне _Локальный компьютер_.

[#check]
== Настройка сервиса проверки подписи

// tag::webconfig[]
[CAUTION]
====
Запросы к облачному сервису электронной подписи отправляются через сервер {wc}а. Это означает, что {wc} должен иметь доступ к сервису ЭП для отправки запросов на проверку подписи и для авторизации.
====

Проверка подлинности подписи может осуществляться локально или через облачный сервис электронной подписи. Способ проверки подписи зависит от настроек в файле конфигурации {wc}а.

.Чтобы изменить способ проверки подлинности подписи:
. Откройте файл конфигурации {wc}а по адресу `{webconfig}`.
. Найдите следующие настройки:
+
[source]
----
<SettingGroup Name="CloudSignature">
    <Setting Name="Address" Value="https://адрес-облачного-сервиса-DSS" /> <.>
    <Setting Name="ClientId" Value="CryptoClient" /> <.>
    <Setting Name="SignServerAppName" Value="SignServer" />
    <Setting Name="STSAppName" Value="STS" />
    <Setting Name="DocumentStoreAppName" Value="stenddssds" /> <.>
    <Setting Name="VerifyUrl" Value="https://dss.cryptopro.ru/verify/rest/api/signatures" /> <.>
    <Setting Name="TSPServiceAddress" Value="" /> <.>
    <Setting Name="SignatureType" Value="BES" /> <.>
    <Setting Name="EnableCloudVerify" Value="True" /> <.>
    <Setting Name="AuthorizeRedirectUrl" Value="http://localhost/DocsvisionWebClient/api/CryptoProDss/AcceptAuthorization" /> <.>
    <Setting Name="TokenStorageMode" Value="InMemory" /> <.>
</SettingGroup>
----
<.> Адрес сервиса облачной подписи.
<.> Идентификатор клиента. Настраивается в сервисе облачной подписи КриптоПро.
<.> `SignServerAppName`, `STSAppName` и `DocumentStoreAppName` -- имена сайтов в IIS на сервере КриптоПро DSS. Настраиваются при установке сервиса электронной подписи КриптоПро DSS.
<.> URL для проверки подлинности подписи.
<.> Адрес сервиса штампа времени для XLT1.
<.> Тип подписи:
+
* `BES` -- будет использоваться CAdES-BES.
* `XLT1` -- будет использоваться CAdES-XLT1.
* `T` -- будет использоваться CAdES-T.
+
<.> Режим проверки подлинности подписи. `True` -- проверка происходит через сервис облачной подписи. `False` -- локально.
<.> URL, на который будет переадресован пользователь после авторизации в сервисе электронной подписи. Настраивается в сервисе электронной подписи.
<.> Режим хранения токена авторизации.
+
.Возможные значения:
* `Disabled` -- авторизация будет запрашиваться каждый раз.
* `InSessionCache` -- авторизация будет повторно запрошена по окончании сессии.
* `InMemory` -- авторизация будет запрошена при перезапуске IIS.
* `InUserProfileEncrypted` -- авторизация будет запрошена по истечении срока действия токена.
// end::webconfig[]
