= Обновление {wc}а

include::ROOT:partial$excerpts.adoc[tags=what-changed]

[#conditions]
== Условия обновления

* Установка новой версии должна выполняться в нерабочее время.
* Если была установлена новая версия модуля _{pl}_ и после её установки была пропущена обязательная операция обновления БД {dv}, обновите БД {dv} перед установкой {wc}а. Cм. инструкцию по обновлению в документации к соответствующей версии модуля "{pl}".
* Перед установкой обновления ознакомьтесь с требованиями к xref:webclient:ROOT:requirements-dv.adoc[системе DocsVision] и xref:webclient:ROOT:requirements-software.adoc[программному обеспечению].
* Если планируется работать с функциями модуля _{arch}_, перед обновлением {wc}а установите серверную часть модуля _{dv} 5. {arch}_ на компьютер с сервером {dv} и компьютер с сервером {wc}а.
* При обновлении версия {wc}а должна равняться версии серверного расширения.
* Для корректной работы данной версии модуля {wc} требуется определённая версия модуля {pl}, требования указаны в пункте "xref:ROOT:requirements-dv.adoc[]".

Режим обновления предназначен для установки новой версии {wc}а без удаления существующей версии.

WARNING: Если вы хотите обновить модуль _{arch}_, сделайте это перед обновлением {wc}а.

При обновлении {wc}а происходит проверка параметра `<LoadLayouts></LoadLayouts>` конфигурационного файла панели управления {wc}а (`WebClientAdminConsole.config`), расположенного по адресу `%LocalAppData%\Docsvision\WebClientAdminConsole.config`.

Если файл отсутствует или значение `<LoadLayouts>true</LoadLayouts>`, {wc} будет обновлён в стандартном режиме с импортом решений в базу данных.

Если значение `<LoadLayouts>false</LoadLayouts>`, при обновлении {wc}а решения не будут автоматически загружено в базу данных, администратор должен будет сделать это самостоятельно позднее.

Редактирование конфигурационного файла панели управления (`WebClientAdminConsole.config`) описывается в пункте xref:create-update-config.adoc[Настройка обновления {wc}а без импорта решений].

Все необходимые для настройки {wc}а параметры будут получены из файла конфигурации {wc}а (`web.config`) установленной версии.

[#update]
== Порядок обновления

[WARNING]
====
Обновление {wc}а также обновляет файл `web.config`. После обновления конфигурационный файл можно заменить на сохранённую версию. В таком случае в скопированной версии потребуется удалить секцию _Databases_. Иначе {wc} не запустится.
====

.Чтобы обновить версию {wc}а:
. С помощью _Мастера добавления ролей и компонентов_ установите компонент _Инициализация приложений_ (_Application Initialization_):
+
.Компоненты IIS в Мастере добавления ролей и компонентов
image::common:app-init.png[Компоненты IIS в Мастере добавления ролей и компонентов]
+
[#backup]
. Создайте резервную копию каталога установки {wc}а. Модуль производит автоматическое резервное копирование критически важных файлов серверного расширения и {wc}а, если установлен следующий флаг при обновлении.
+
.Флаг автоматического резервного копирования
image::install-server-location.png[Флаг автоматического резервного копирования]
+
Если критически важные файлы (определяются модулем) были изменены с момента последней установки или отсутствовали в дистрибутиве, они будут помещены в каталог:
+
* `C:\ProgramData\Docsvision\Backups\WebClient\дата-время.zip`.
* `C:\ProgramData\Docsvision\Backups\WebClientServerExtension\дата-время.zip`.
+
. Остановите пул приложений _{dv}SitePool_ на компьютере с сервером {wc}а.
. xref:install-server.adoc[Установите] новую версию *серверного расширения {wc}* без удаления существующей.
. xref:install-client.adoc[Установите] новую версию *{wc}а* без удаления существующей.
. После завершения установки будет запущен мастер настройки {wc}а.
+
.Мастер настройки {wc}а с режимом обновления
image::config-update-mode.png[Мастер настройки {wc}а с режимом обновления]
+
. Нажмите кнопку *Обновление* в окне мастера настройки, чтобы начать процесс обновления конфигурации.
. Дождитесь завершения обновления базы данных.
+
В процессе обновления стандартные решения {wc}а в базе данных по умолчанию будут перезаписаны.
+
Формат Решений, загруженных в БД по умолчанию, будет обновлен до новой версии.
+
. Если файл `web.config` предыдущей версии был модифицирован при настройке {wc}а, и данные изменения требуется перенести в новую версию, выполните перенос вручную из резервной копии файла, созданной на <<backup,шаге 2>>.
. При обновлении также происходит проверка параметра *_LoadLayouts_* в файле конфигурации по адресу `%LocalAppData%\Docsvision\WebClientAdminConsole.config`. В зависимости от значения *_true_* или *_false_* разметки будут автоматически загружены в базу данных или администратору нужно будет импортировать их вручную позднее.
. Запустите остановленный пул приложений _{dv}SitePool_.
. На последней странице мастера настройки будет показан URL-адрес {wc}а для пользователей.
. Если {wc} функционирует в кластере, выполните инструкцию xref:dvweb-cluster.adoc[Настройка утилиты DVWebTool для работы в кластере].
+
NOTE: Также данную инструкцию нужно выполнить, если подключение к {wc}у осуществляется через промежуточное устройство и при этом сервер {wc}а недоступен пользователям по его фактическому адресу.
+
NOTE: Перед обновлением измените тип подключения {wc}а к серверу {dv}, если адрес был изменён.
