= Задание на консолидацию

Основная задача консолидатора -- сформировать итоговую версию согласуемого документа из всех версий, добавленных согласующими. В дальнейшем итоговая версия может быть отправлена на окончательное подписание, или быть использована в качестве стартовой в новом цикле согласования. Без выполнения консолидации или копирования какой-либо версии в итоговую согласующие или подписывающие в заданиях на согласование или на подписание всегда будут получать копию файла, отправленного при старте согласования.

.Консолидатор может выполнять следующие действия в карточке задания на консолидацию:
* xref:approval-files.adoc[Ознакомиться с составом согласуемых и дополнительных файлов].
* xref:approval-files.adoc#add-version[Работать с версиями согласуемых файлов] -- создавать и редактировать собственную версию файла, просматривать версии остальных участников согласования.
* xref:approval-users-consolidator.adoc#autoconsolidation[Создать объединенную версию].
* Работать с областью комментариев на протяжении всей работы с заданием.
* Ознакомиться с ходом согласования, решениями других участников.
* xref:approval-performer.adoc[Завершить задание путем выбора одного из доступных вариантов решений].

При работе с файлами _Консолидатор_ дополнительно может назначить любую версию в дереве итоговой, для подведения итогов определённой стадии согласования.

.Чтобы получить документ на консолидацию:
include::partial$excerpts.adoc[tags=incomingFolder]
+
. Откройте полученное задание _На консолидацию_ с состоянием `Не начато`.
+
.Задание на консолидацию
image::approval-consolidator.png[Задание на консолидацию]
+
.Описание разделов карточки задания:
****
Информация о документе::
Содержит общую информацию о карточке Документ, файлы которой поступили на консолидацию после согласования.
Ссылка на карточку::
Содержит ссылку для перехода к карточке согласуемого документа.
Файлы для консолидации (N)::
Согласуемые файлы. Консолидатору доступны версии:
Исходная версия цикла:::
Версия, поступившая в цикл согласования с предыдущего цикла, или исходная версия, если текущий цикл согласования является первым.
Версии участников:::
Итоговая версия этапа:::
Версия для использования в качестве результата выполнения консолидации (выделена жирным шрифтом). В полученном задании данная версия будет совпадать со стартовой версией этапа, если предшествующий текущему этап был параллельный. Данная версия будет совпадать с последней созданной на предыдущем этапе версией, если этап был последовательным или альтернативным.
Ход согласования::
Содержит информацию об этапах согласования: список согласующих и принятые ими решения, комментарии к решениям и добавленные версии файлов. К комментарию может быть приложен файл замечаний.
Обсуждение::
Комментарии по данному заданию. Подробности в пункте xref:approval-discussion.adoc[Обсуждение согласования].
****
+
. Выполните требуемые операции с версиями согласуемых файлов.
+
.Операции с версиями согласуемых файлов
****
* Ознакомьтесь с составом xref:approval-files.adoc[согласуемых и дополнительных файлов].
* xref:approval-files.adoc#add-version[Добавьте собственную версию согласуемого файла].
* xref:approval-users-consolidator.adoc#autoconsolidation[Создайте объединенную версию].
* xref:approval-files.adoc#add-comment[Добавьте комментарий к версии].
+
После изучения версий согласующих, консолидатор должен определить версию, которую планируется использовать либо как итоговую по результатам согласования, либо как стартовую в следующем этапе/цикле согласования. В качестве итоговой консолидатор может выбрать версию любого из согласующих на любом этапе/цикле, либо собственную версию.

В дальнейшем процессе согласования будет использоваться итоговая версия. Эту версию консолидатор может отправить на подписание.

Если инициатор отправляет документ на новый цикл согласования, итоговая версия, выбранная при консолидации, становится исходной для нового цикла согласования.

_Консолидатор_ в списке всех версий увидит выделенную итоговую версию предыдущего цикла, которая является текущей на данный момент. В области _Основные файлы_ будет отображаться текущая версия, являющаяся итоговой версией предыдущего цикла. Инициатор консолидирует замечания согласующих и помечает отредактированную версию как текущую. Она становится итоговой.

В списке версий основного документа итоговая версия выделена жирным шрифтом.

В области _Основные файлы_ отображается текущая версия основного документа, а не последняя прикрепленная.
****
+
. Выберите итоговую версию.
+
****
.. В разделе _Файлы для консолидации_ выберите xref:approval-files.adoc#viewVersions[версию], на основе которой требуется создать собственную версию файла.
.. Нажмите image:buttons/vertical-dots.png[Три вертикальные точки] справа от названия файла и выберите команду *Скопировать в итоговую*. Выбранная версия заменяет _Версию №K.N_ на панели _Файлы_ (номер версии при этом не изменяется).
+
.Назначение итоговой версии
image::set-consolidate-version.png[Назначение итоговой версии]
+
Итоговая версия будет считаться результатом выполнения консолидации. При переходе к следующему этапу маршрута согласования, данная версия будет скопирована в задания согласующих.
****
+
. Примите решение по консолидации. Для этого нажмите соответствующую кнопку принятия решения.
+
****
[horizontal]
Отправить на подписание::
Документ будет отправлен на этап подписания.
Новый цикл согласования::
Будет запущен новый цикл согласования.
Завершить согласование::
Согласование будет принудительно завершено. Документ перейдет в состояние `Согласован` или `Подписан` с сохранением результатов текущего согласования при отсутствии отрицательных решений по согласованию.
+
Незавершённые задания исполнителей будут отозваны.
+
Отменить согласование::
Согласование будет отменено. Документ перейдет в состояние `Подготавливается`, если данное состояние определено для вида карточки в _Конструкторе состояний_. Незавершённые задания исполнителей будут отозваны.

[horizontal]
.Также могут быть доступны дополнительные варианты:
Делегировать::
Делегирует задание другому исполнителю;
Добавить согласующих::
Добавляет новых участников в согласование. Инструкция по работе с механизмом дополнительных согласующих приведена в xref:approval-additional-approvers.adoc[Дополнительные согласующие].

Результат согласования будет отображен в блоке _Ход согласования_.
****
+
. Если принятое решение по согласованию предполагает ввод комментария, в открывшемся окне введите причину, по которой было принято соответствующее решение, и нажмите кнопку *Подтвердить*.
+
****
Задание перейдет в состояние Завершено.

Добавленный к решению комментарий будет отображаться в блоке _Ход согласования_.
****

[#advanced]
== Усовершенствованное согласование

При усовершенствованном согласовании внешний вид задания консолидации не изменяется.

.Итоговая версия в задании на консолидацию
image::advanced-consolidation.png[Итоговая версия в задании на консолидацию]

В заголовке отображается итоговая версия, если она назначена. До тех пор, пока итоговая версия не назначена, в заголовке отображается начальная версия этапа консолидации.

.Список версий выводится в следующем порядке:
* Исходная версия этапа консолидации. Строчка добавляется только если она не является одной из версий из очереди консолидации.
* Версии из очереди консолидации в порядке их создания.
* Версии, добавленные на этапе консолидации.

Итоговая версия этапа выделяется жирным шрифтом, в описании к ней указан префикс *ИТОГОВАЯ -*.

Все версии отображаются с порядковыми номерами, см. подробнее xref:approval-files.adoc#advanced[Правила формирования версий файлов при усовершенствованном согласовании]. Загруженная версия назначается итоговой.

.Набор операций, доступных для всех версий:
* *Скачать* и *Комментировать*.
* *Открыть*. При редактировании создается новая версия консолидатора.
* *Назначить итоговой*. Для всех версий, кроме итоговой. При выполнении данной операции выбранная становится итоговой, новая версия не создается.

// права перетекают по операции _Операции согласования_
.Операции для версий, созданных из этого задания:
* Удалить.

[#autoconsolidation]
== Создание объединенной версии

Консолидатор может создать версию, включающую изменения других согласующих, воспользовавшись функцией автоматического объединения версий -- функцией автоконсолидации.

.Требования для использования автоконсолидации:
****
. На компьютере пользователя должны быть установлены:
+
* xref:webclient:ROOT:requirements-software.adoc#autoconsoliadtion[Microsoft Word].
* Программа xref:prepare-add-components.adoc#dvWebTool[DVWebTool].
+
. Объединяемые файлы должны быть одного из допустимых форматов: `.docx`, `.docm`, `.doc`, `.rtf`, `.dotx`, `.dotm`, `.dot`, `.odt`.
. Программа _DVWebTool_ должна быть запущена от имени пользователя, авторизованного в {wc}е и выполняющего автоконсолидацию.
****

.Чтобы создать объединенную версию:
. Получите задание на консолидацию.
. Нажмите кнопку *Объединить версии*.
+
****
Будет запущен процесс создания объединённой версии, которая будет назначена итоговой.
****
+
.Кнопка "Объединить версии" в задании консолидации
image::merge-version.png[Кнопка "Объединить версии" в задании консолидации]
+
NOTE: На время выполнения операции пользовательский интерфейс блокируется. Блокировка будет снята после того как появится сообщение о завершении объединения.
+
****
Если программа _DVWebTool_ не запущена, при нажатии кнопки *Объединить версии* будет предложено установить её. В данном случае нажмите кнопку *Объединить версии* после установки и запуска программы.
****
